<main class="shell" [class.has-result]="searched()">

  <!-- ======= HERO SECTION ======= -->
  <section class="hero">
    <div class="hero-content">

      <!-- Logo + Branding -->
      <div class="brand-area">
        <img class="logo" src="assets/images/logo.png" alt="ChessMate logo" />
        <h1 class="brand-title">
          <span class="brand-chess">Chess</span><span class="brand-mate">Mate</span>
        </h1>
        <p class="brand-subtitle">Analyze your chess games and improve your skills</p>
      </div>

      <!-- Search Form -->
      <form class="search-form" (submit)="$event.preventDefault()">
        <div class="search-input-wrapper" [class.has-error]="!!getControlError()">
          <input
            class="search-input"
            type="text"
            [formControl]="usernameControl"
            placeholder="chess.com username..."
            (keydown.enter)="search()" />
          <button class="search-icon-btn" type="button" (click)="search()" [disabled]="loading()" aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
          </button>
        </div>
        <p *ngIf="getControlError() as controlError" class="search-error" role="alert">{{ controlError }}</p>
      </form>

      <!-- ======= GAMES SECTION ======= -->
      <section class="games-section" #gamesSection *ngIf="searched() || games().length > 0">

    <!-- Section header -->
    <div class="games-header">
      <h2 class="games-title">Recent Games</h2>
      <select id="analysis-mode" class="mode-select" [value]="analysisMode()" (change)="setAnalysisMode($any($event.target).value)">
        <option value="quick">Quick</option>
        <option value="deep">Deep</option>
      </select>
    </div>

    <!-- Loading -->
    <div *ngIf="loading(); else loadedState" class="loading-state" role="status" aria-label="Loading games">
      <span class="spinner"></span>
      <span class="sr-only">Loading...</span>
    </div>

    <ng-template #loadedState>

      <!-- Error state -->
      <div *ngIf="errorMessage() as currentError" class="error-state" role="alert">
        <p class="error-message">{{ currentError }}</p>
        <ul *ngIf="fieldErrors() as currentFieldErrors" class="error-fields">
          <li *ngFor="let entry of currentFieldErrors | keyvalue">
            <strong>{{ entry.key }}:</strong> {{ entry.value.join(', ') }}
          </li>
        </ul>
      </div>

      <!-- Game cards grid -->
      <div *ngIf="games().length > 0; else emptyState" class="games-grid">
        <article
          *ngFor="let game of displayedGames(); trackBy: trackByGameId"
          class="game-card">

          <!-- White player row -->
          <div class="player-row">
            <span class="player-dot player-dot-white" aria-hidden="true"></span>
            <span class="player-name">{{ game.whitePlayer || 'Unknown' }}</span>
            <span class="player-rating" *ngIf="game.whiteRating">{{ game.whiteRating }}</span>
          </div>

          <!-- Black player row -->
          <div class="player-row">
            <span class="player-dot player-dot-black" aria-hidden="true"></span>
            <span class="player-name">{{ game.blackPlayer || 'Unknown' }}</span>
            <span class="player-rating" *ngIf="game.blackRating">{{ game.blackRating }}</span>
          </div>

          <!-- Card meta row -->
          <div class="game-card-meta">
            <span class="game-time-control">{{ formatTimeControl(game.timeControl) }}</span>
            <span
              class="game-result-badge"
              [class.result-win]="getResultClass(game) === 'win'"
              [class.result-loss]="getResultClass(game) === 'loss'"
              [class.result-draw]="getResultClass(game) === 'draw'">
              {{ formatResult(game) }}
            </span>
          </div>

          <!-- Actions -->
          <div class="game-card-actions">
            <a [href]="game.url" target="_blank" rel="noreferrer" class="view-link">View</a>
            <button
              class="analyze-btn"
              type="button"
              (click)="openAnalysis(game)"
              [disabled]="analyzingGameId() !== null"
              [attr.aria-label]="'Analyze ' + (game.opening || 'game')">
              Analyze
            </button>
          </div>
        </article>
      </div>

      <ng-template #emptyState>
        <p *ngIf="searched(); else firstLoadState" class="empty-state">No games were returned for this page.</p>
      </ng-template>

      <ng-template #firstLoadState>
        <p class="empty-state">Run a search to load games.</p>
      </ng-template>

    </ng-template>

    <!-- Pagination -->
    <div class="pagination">
      <button
        class="pager-btn"
        type="button"
        (click)="previousPage()"
        [disabled]="!canGoPrevious()"
        aria-label="Previous page">
        &#8249;
      </button>
      <span class="page-indicator">Page {{ page() }}</span>
      <button
        class="pager-btn"
        type="button"
        (click)="nextPage()"
        [disabled]="!canGoNext()"
        aria-label="Next page">
        &#8250;
      </button>
    </div>

</section>

    </div>

    <!-- Right side chess frame -->
    <div class="hero-image" aria-hidden="true"></div>
  </section>
</main>

